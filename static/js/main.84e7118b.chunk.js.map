{"version":3,"sources":["ToggleablePanel.module.css","defaultPropTypes.js","nodeData.js","ColourScales.js","fillFunctions.js","datetimes.js","colourKeys.js","visualizationData.js","ToggleablePanel.js","HelpPanel.js","ColourKey.js","VisColourKey.js","couplingBuckets.js","CouplingController.js","Controller.js","PathInspector.js","CouplingInspector.js","NodeInspector.js","DirectoryNodeInspector.js","Inspector.js","Viz.js","State.js","App.js","preprocess.js","Loader.js","serviceWorker.js","index.js","PathInspector.module.css"],"names":["module","exports","PropTypes","shape","current","any","isRequired","config","couplingConfig","expensiveConfig","constants","func","isHierarchyNode","node","undefined","parent","dataNode","data","nodePath","path","nodeDescendants","descendants","nodes","children","forEach","child","addDescendants","push","nodeLocData","loc","nodeCumulativeLinesOfCode","value","nodeDepth","d","Error","depth","nodeGitData","git","nodeCreationDate","creation_date","nodeRemoteUrl","remote_url","nodeChangeDetails","earliest","latest","details","filter","commit_day","nodeLastCommitDay","length","nodeAge","lastCommit","Math","ceil","nodeNumberOfChangers","_","uniq","flatMap","users","nodeChurnData","totalLines","totalCommits","totalDays","changeSize","lines_added","lines_deleted","commits","duration","fractionalLines","fractionalCommits","fractionalDays","nodeCouplingData","coupling","nodeHasCouplingData","filesHaveMaxCommonRoots","maxCommonRoots","file1","file2","f1bits","split","f2bits","maxLength","commonLength","index","console","log","commonRoots","nodeCouplingFilesFiltered","minRatio","minDays","files","couplingData","buckets","bucket","bucket_start","bucket_end","totalCommitDays","commit_days","coupled_files","filename","count","Object","entries","map","file","source","targetFile","sourceCount","targetCount","nodeCouplingFiles","f","nodeCenter","layoutData","theNode","layout","nodeLayoutData","center","goodBadUglyScaleBuilder","configLocation","metadata","get","good","bad","ugly","colours","currentTheme","goodColour","badColour","uglyColour","d3","domain","range","interpolate","clamp","goodBadUglyScale","standardFillBuilder","scale","dataFn","parentFn","neutralColour","dateRange","override","nonexistentColour","circlePackBackground","algorithm","creationDate","overrideColourFunction","humanizeDate","unixdate","moment","unix","format","dateToUnix","jsDate","unixToDate","date","toDate","goodBadUglyColourKeyData","vis","precision","colourScaleBuilder","goodBad","badUgly","key","ix","metric","round","toFixed","blankParent","VisualizationData","language","displayOrder","title","subVis","help","fillFnBuilder","languageMap","languages","colour","colourKeyBuilder","languageKey","otherColour","k","maxDepth","stats","indentation","defaultChild","sum","p99","stddev","age","creation","earlyColour","lateColour","floor","numberOfChangers","conf","fewChangersMin","fewChangersMax","manyChangersMax","noChangersColour","oneChangerColour","fewChangersMinColour","fewChangersMaxColour","manyChangersColour","i","scaleIncrement","n","churn","days","lines","ToggleablePanel","props","showInitially","showText","hideText","borderlessIfHidden","React","useState","showResults","setShowResults","onClick","hiddenBorderStyle","styles","borderless","hidden","className","panel","shown","type","HelpPanel","ColourKey","keyData","style","backgroundColor","width","VisColourKey","earliestDate","latestDate","couplingDateRange","couplingStats","bucketCount","bucketSize","firstBucketStart","results","start","end","allBuckets","bucketsSelected","couplingStart","couplingEnd","CouplingController","dispatch","state","couplingAvailable","sliderId","useRef","_uniqueId","minDaysId","maxRootsId","bucketDays","showButton","payload","htmlFor","id","min","max","step","onChange","evt","Number","parseFloat","target","name","parseInt","Array","maxMinDays","keys","Controller","dataRef","vizId","depthId","subVizId","sortedVis","sort","k1","k2","currentParentVisData","visualization","currentSubVisData","sortedSubVis","currentVisOrSub","themeButton","PathInspector","parents","currentNode","reverse","pathlist","CouplingInspector","couplingDetails","f1","f2","slice","ratio","findGitUrl","suffix","remote","sshRemoteRe","test","replace","startsWith","substr","endsWith","head","nodeRemoteHead","NodeInspector","locData","indentationData","nodeIndentationData","gitUrl","topChangersCount","creationText","ageText","daysRemaining","years","weeks","t","join","humanizeDays","changerCount","topChangers","maxPeople","changerStats","Map","user","has","set","ac","nodeTopChangers","topChangerTable","userId","email","userName","churnData","href","code","p90","churnReport","DirectoryNodeInspector","Inspector","selectedNode","hasSelection","nodeInspector","redrawPolygons","svgSelection","selected","warn","getCurrentVis","fillFn","attr","polygon","defaultStroke","redrawSelection","selectedStroke","findSelectionPath","drawCoupling","group","nodesByPath","allCouplingNodes","rootNode","flat","normalizedCouplingNodes","couplingNodes","selectAll","newCouplingNodes","enter","append","classed","merge","leftHand","x1","y1","x2","y2","dx","dy","dr","sqrt","sweep","arcPath","couplingStroke","opacity","on","nodeList","hierarchNode","text","from","exit","remove","updateBodyTheme","newTheme","document","body","Viz","d3Container","d3TimescaleContainer","prevState","ref","useEffect","usePrevious","timescaleData","isEqual","vizEl","svg","selectionPath","selectionNodes","newSelectionNodes","update","updateCoupling","timescaleHeight","w","clientWidth","h","clientHeight","height","allNodes","newNodes","raise","call","extent","scaleExtent","transform","draw","margin","x","y","valueFn","yMax","xScale","day","yScale","xAxis","g","ticks","tickSizeOuter","brush","selection","invert","startDate","endDate","y0","move","drawTimescale","viewBox","refX","refY","markerWidth","markerHeight","markerUnits","xoverflow","orient","fill","initialiseGlobalState","initialDataRef","earliestCommit","latestCommit","twoYearsAgo","subtract","maxAge","low","high","dark","light","globalDispatchReducer","action","visData","early","late","result","cloneDeep","App","useReducer","vizState","countLanguagesIn","counts","addLanguagesFromNode","countsPairs","sortedMap","val","gatherNodeStats","statsSoFar","nodeLinesOfCode","maxLoc","gitData","lastUpdate","reduce","memo","gatherGlobalStats","maxLines","maxCommits","maxDays","gatherTimescaleData","timeUnit","addTimescaleData","startOf","dateData","dayData","a","b","gatherNodesByPath","addNodesByPath","Loader","dataFile","process","REACT_APP_EXPLORER_DATA","url","setData","fetch","response","json","git_meta","coupling_meta","bucket_count","bucket_size","first_bucket_start","fetchData","useFetch","Boolean","window","location","hostname","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.84e7118b.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"panel\":\"ToggleablePanel_panel__1uP4D\",\"hidden\":\"ToggleablePanel_hidden__OCbO8\",\"borderless\":\"ToggleablePanel_borderless__c11Ni\"};","import PropTypes from \"prop-types\";\n\nconst defaultPropTypes = {\n  /* eslint-disable react/forbid-prop-types */\n  dataRef: PropTypes.shape({ current: PropTypes.any }).isRequired,\n  state: PropTypes.shape({\n    config: PropTypes.any.isRequired,\n    couplingConfig: PropTypes.any.isRequired,\n    expensiveConfig: PropTypes.any.isRequired,\n    constants: PropTypes.any.isRequired,\n  }).isRequired,\n  dispatch: PropTypes.func.isRequired,\n};\n\nexport default defaultPropTypes;\n","import _ from \"lodash\";\n\n/* Note most functions here work on both:\n- a data node, the data from the raw JSON file, which is roughly\n{\n  data: metadata like lines of code\n  children: optional list of children (only for directories)\n  layout: pre-generated layout data\n  name: filename/folder name\n  path: full path from root\n  value: pre-calculated lines of code (calculated in preprocessor, cumulative of all children)\n  }\n\n  - a hierarchy node, from d3 hierarchy magic, which has:\n  {\n    data: the dataNode above\n    children: optional list of children (only for directories) but each child is a hierarchy node\n    depth: depth from the rood\n    height: height from leaves?\n    parent: parent hierarchy node\n    value: same as data.value, calculated cumulative size\n   }\n\n   We get hierarchy nodes from viz things, but in some cases (like caching initial data)\n   we only have raw data.  For ease of reuse, functions here will detect the kind of node they have.\n */\n\nexport function isHierarchyNode(node) {\n  return node.parent !== undefined; // parent is defined but null for the root node\n}\n\nexport function isDirectory(node) {\n  // both kinds of nodes have or don't have children!\n  return node.children !== undefined && node.children !== null;\n}\n\nexport function dataNode(node) {\n  return isHierarchyNode(node) ? node.data : node;\n}\n\nexport function nodePath(node) {\n  return dataNode(node).path;\n}\nexport function nodeName(node) {\n  return dataNode(node).name;\n}\n\nfunction addDescendants(nodes, node) {\n  nodes.push(node);\n  if (node.children) {\n    node.children.forEach((child) => addDescendants(nodes, child));\n  }\n}\n// simulate d3.descendants but works for non-hierarchy nodes (so we don't need to build a hierarchy)\nexport function nodeDescendants(node) {\n  if (isHierarchyNode(node)) {\n    return node.descendants();\n  }\n  const nodes = [];\n  node.children.forEach((child) => addDescendants(nodes, child));\n\n  return nodes;\n}\n\nexport function nodeLocData(node) {\n  const { data } = dataNode(node);\n\n  if (!data || !data.loc) return undefined;\n  return data.loc;\n}\n\nexport function nodeLanguage(node) {\n  const loc = nodeLocData(node);\n  if (!loc) return undefined;\n  return loc.language;\n}\n\nexport function nodeLinesOfCode(node) {\n  const loc = nodeLocData(node);\n  if (!loc) return undefined;\n  return loc.code;\n}\n\nexport function nodeCumulativeLinesOfCode(node) {\n  return dataNode(node).value;\n}\n\nexport function nodeDepth(d) {\n  if (!isHierarchyNode(d)) throw Error(\"Can't get depth for data node\");\n  return d.depth;\n}\n\nexport function nodeGitData(node) {\n  const { data } = dataNode(node);\n\n  if (!data || !data.git) return undefined;\n  return data.git;\n}\n\nexport function nodeCreationDate(node) {\n  const git = nodeGitData(node);\n  if (!git) return undefined;\n\n  return git.creation_date;\n}\n\nexport function nodeCreationDateClipped(node, earliest, latest) {\n  const creationDate = nodeCreationDate(node);\n  if (!creationDate) return undefined;\n  if (creationDate > latest) return undefined;\n  if (creationDate < earliest) return undefined;\n  return creationDate;\n}\n\nexport function nodeRemoteUrl(node) {\n  const git = nodeGitData(node);\n  if (!git) return undefined;\n\n  return git.remote_url;\n}\n\nexport function nodeRemoteHead(node) {\n  const git = nodeGitData(node);\n  if (!git) return undefined;\n\n  return git.head;\n}\n\nexport function nodeIndentationData(node) {\n  const { data } = dataNode(node);\n  if (!data || !data.indentation) return undefined;\n  return data.indentation;\n}\n\nexport function nodeIndentation(node, metric) {\n  const { data } = dataNode(node);\n  if (!data || !data.indentation) return undefined;\n  return data.indentation[metric];\n}\n\nexport function nodeIndentationSum(node) {\n  const { data } = dataNode(node);\n  if (!data || !data.indentation) return undefined;\n  return data.indentation.sum;\n}\n\nexport function nodeIndentationP99(node) {\n  const { data } = dataNode(node);\n  if (!data || !data.indentation) return undefined;\n  return data.indentation.p99;\n}\n\nexport function nodeIndentationStddev(node) {\n  const { data } = dataNode(node);\n  if (!data || !data.indentation) return undefined;\n  return data.indentation.stddev;\n}\n\n// Date range based data, mostly git details\n\nfunction nodeChangeDetails(node, earliest, latest) {\n  const git = nodeGitData(node);\n  if (!git) return undefined;\n  const { details } = git;\n  if (!details) return undefined;\n  if (earliest === undefined && latest === undefined) return details;\n  return details.filter(\n    (d) => d.commit_day >= earliest && d.commit_day <= latest\n  );\n}\n\nexport function nodeLastCommitDay(node, earliest, latest) {\n  const details = nodeChangeDetails(node, earliest, latest);\n  if (!details || details.length === 0) return undefined; // TODO: distinguish no history from undefined!\n  return details[details.length - 1].commit_day;\n}\n\nexport function nodeAge(node, earliest, latest) {\n  const lastCommit = nodeLastCommitDay(node, earliest, latest);\n  if (!lastCommit) return undefined;\n  return Math.ceil((latest - lastCommit) / (24 * 60 * 60));\n}\n\nexport function nodeTopChangers(node, earliest, latest, maxPeople) {\n  const details = nodeChangeDetails(node, earliest, latest);\n  if (!details) return undefined;\n  const changerStats = new Map();\n  details.forEach(({ users, commits }) => {\n    users.forEach((user) => {\n      if (!changerStats.has(user)) {\n        changerStats.set(user, commits);\n      } else {\n        changerStats.set(user, changerStats.get(user) + commits);\n      }\n    });\n  });\n\n  return [...changerStats.entries()]\n    .sort(([au, ac], [bu, bc]) => {\n      return bc - ac;\n    })\n    .slice(0, maxPeople);\n}\n\nexport function nodeNumberOfChangers(node, earliest, latest) {\n  const details = nodeChangeDetails(node, earliest, latest);\n  if (!details) return undefined;\n  const changers = _.uniq(details.flatMap((d) => d.users));\n  return changers.length;\n}\n\nexport function nodeChurnData(node, earliest, latest) {\n  const details = nodeChangeDetails(node, earliest, latest);\n  if (!details) return undefined;\n  let totalLines = 0;\n  let totalCommits = 0;\n  const totalDays = details.length;\n  details.forEach((d) => {\n    const changeSize = d.lines_added + d.lines_deleted;\n    totalCommits += d.commits;\n    totalLines += changeSize;\n  });\n  const duration = (latest - earliest) / (24 * 60 * 60);\n\n  return {\n    totalLines,\n    totalCommits,\n    totalDays,\n    fractionalLines: totalLines / duration,\n    fractionalCommits: totalCommits / duration,\n    fractionalDays: totalDays / duration,\n  };\n}\n\nexport function nodeChurnDays(node, earliest, latest) {\n  const data = nodeChurnData(node, earliest, latest);\n  if (!data) return undefined;\n  return data.fractionalDays;\n}\n\nexport function nodeChurnCommits(node, earliest, latest) {\n  const data = nodeChurnData(node, earliest, latest);\n  if (!data) return undefined;\n  return data.fractionalCommits;\n}\n\nexport function nodeChurnLines(node, earliest, latest) {\n  const data = nodeChurnData(node, earliest, latest);\n  if (!data) return undefined;\n  return data.fractionalLines;\n}\n\nexport function nodeCouplingData(node) {\n  const { data } = dataNode(node);\n\n  if (!data || !data.coupling) return undefined;\n  return data.coupling;\n}\n\nexport function nodeHasCouplingData(node) {\n  return nodeCouplingData(node) !== undefined;\n}\n\nexport function nodeCouplingFiles(node, earliest, latest) {\n  const couplingData = nodeCouplingData(node);\n  if (!couplingData) return undefined;\n  const buckets = couplingData.buckets.filter((bucket) => {\n    if (bucket.bucket_start > latest) return false;\n    if (bucket.bucket_end < earliest) return false;\n    return true;\n  });\n  if (buckets.length === 0) {\n    // nothing in current selection\n    return [];\n  }\n  let totalCommitDays = 0;\n  const files = {};\n  buckets.forEach((bucket) => {\n    totalCommitDays += bucket.commit_days;\n    bucket.coupled_files.forEach(([filename, count]) => {\n      if (files[filename] === undefined) {\n        files[filename] = count;\n      } else {\n        files[filename] += count;\n      }\n    });\n  });\n  // convert to array so vis.js can render each coupling line\n  return Object.entries(files).map(([file, count]) => {\n    return {\n      source: node,\n      targetFile: file,\n      sourceCount: totalCommitDays,\n      targetCount: count,\n    };\n  });\n}\n\nfunction commonRoots(file1, file2) {\n  const f1bits = file1.split(\"/\");\n  const f2bits = file2.split(\"/\");\n  let maxLength = f1bits.length;\n  if (f2bits.length < maxLength) {\n    maxLength = f2bits.length;\n  }\n  let commonLength = 0;\n  let index = 0;\n  while (f1bits[index] === f2bits[index]) {\n    commonLength += 1;\n    if (index >= maxLength) break;\n    index += 1;\n  }\n  console.log(\"commonRoots\", file1, file2, commonLength);\n  return commonLength;\n}\n\nfunction filesHaveMaxCommonRoots(maxCommonRoots, file1, file2) {\n  if (maxCommonRoots < 0) return true;\n  const common = commonRoots(file1, file2);\n  return common <= maxCommonRoots;\n}\n\nexport function nodeCouplingFilesFiltered(\n  node,\n  earliest,\n  latest,\n  minRatio,\n  minDays,\n  maxCommonRoots\n) {\n  const files = nodeCouplingFiles(node, earliest, latest);\n  if (files === undefined || files.length === 0) return files;\n  return files.filter((f) => {\n    return (\n      f.sourceCount >= minDays &&\n      f.targetCount / f.sourceCount > minRatio &&\n      filesHaveMaxCommonRoots(maxCommonRoots, nodePath(f.source), f.targetFile)\n    );\n  });\n}\n\nexport function nodeLayoutData(node) {\n  const theNode = dataNode(node); // not in nested 'data' part!\n\n  if (!theNode || !theNode.layout) return undefined;\n  return theNode.layout;\n}\n\nexport function nodeCenter(node) {\n  const layoutData = nodeLayoutData(node);\n  if (!layoutData) return undefined;\n  return layoutData.center;\n}\n","import * as d3 from \"d3\";\nimport _ from \"lodash\";\n\nexport function numberOfChangersScale(config, metadata) {\n  const { numberOfChangers: conf } = config;\n  return d3\n    .scaleLinear()\n    .domain([\n      0,\n      1,\n      conf.fewChangersMin,\n      conf.fewChangersMax,\n      conf.manyChangersMax,\n    ])\n    .range([\n      conf.noChangersColour,\n      conf.oneChangerColour,\n      conf.fewChangersMinColour,\n      conf.fewChangersMaxColour,\n      conf.manyChangersColour,\n    ])\n    .interpolate(d3.interpolateHcl)\n    .clamp(true);\n}\n\nexport function goodBadUglyScale(config, good, bad, ugly) {\n  const { goodColour, badColour, uglyColour } = config.colours[\n    config.colours.currentTheme\n  ];\n\n  return d3\n    .scaleLinear()\n    .domain([good, bad, ugly])\n    .range([goodColour, badColour, uglyColour])\n    .interpolate(d3.interpolateHcl)\n    .clamp(true);\n}\n\nexport function goodBadUglyScaleBuilder(configLocation) {\n  return (config, metadata) => {\n    const { good, bad, ugly } = _.get(config, configLocation);\n    return goodBadUglyScale(config, good, bad, ugly);\n  };\n}\n\nexport function languageScaleBuilder(config, metadata) {\n  const { languageMap } = metadata.languages;\n  return (d) => {\n    return languageMap[d].colour;\n  };\n}\n\nexport function depthScaleBuilder(config, metadata) {\n  const { maxDepth } = metadata.stats;\n\n  return d3\n    .scaleSequential(d3.interpolatePlasma)\n    .domain([0, maxDepth])\n    .clamp(true);\n}\n\nexport function earlyLateScaleBuilder(config, metadata) {\n  const { earlyColour, lateColour } = config.colours[\n    config.colours.currentTheme\n  ];\n  const { earliest, latest } = config.dateRange;\n\n  return d3\n    .scaleLinear()\n    .domain([earliest, latest])\n    .range([earlyColour, lateColour])\n    .interpolate(d3.interpolateHcl)\n    .clamp(true);\n}\n","/*\nFill Builders are called when config changes, they return a fill function\nwhich only needs a node as a parameter, and return a colour.\n */\n\n// overrides most other colours - mostly top-level circle packed background, and files that don't exist yet\n// returns a colour, or undefined if there is no override\nimport { nodeCreationDate } from \"./nodeData\";\n\nfunction overrideColourFunction(node, config) {\n  const { nonexistentColour, circlePackBackground } = config.colours[\n    config.colours.currentTheme\n  ];\n  const { latest } = config.dateRange;\n\n  if (node.data.layout.algorithm === \"circlePack\") return circlePackBackground;\n  const creationDate = nodeCreationDate(node);\n  if (creationDate && creationDate > latest) return nonexistentColour;\n  return undefined;\n}\n\n// TODO: this could be scrapped as it works for every case!\nexport default function standardFillBuilder(config, scale, dataFn, parentFn) {\n  const { neutralColour } = config.colours[config.colours.currentTheme];\n  const { earliest, latest } = config.dateRange;\n  return (d) => {\n    const override = overrideColourFunction(d, config);\n    if (override) return override;\n    const value = d.children\n      ? parentFn(d, earliest, latest)\n      : dataFn(d, earliest, latest);\n\n    return value === undefined ? neutralColour : scale(value);\n  };\n}\n","import moment from \"moment\";\n\nexport function humanizeDate(unixdate) {\n  return moment.unix(unixdate).format(\"DD-MMM-YYYY\");\n}\n\nexport function dateToUnix(jsDate) {\n  return moment(jsDate).unix();\n}\n\nexport function unixToDate(date) {\n  return moment.unix(date).toDate();\n}\n\nexport function humanizeDays(days) {\n  let daysRemaining = days;\n  let years = 0;\n  let weeks = 0; // no months, as they are not really precise\n  if (daysRemaining > 365) {\n    years = Math.floor(daysRemaining / 365);\n    daysRemaining %= 365;\n  }\n  if (daysRemaining > 7) {\n    weeks = Math.floor(daysRemaining / 7);\n    daysRemaining %= 7;\n  }\n  const yearText =\n    years > 0 ? `${years} year${years > 1 ? \"s\" : \"\"}` : undefined;\n  const weekText =\n    weeks > 0 ? `${weeks} week${weeks > 1 ? \"s\" : \"\"}` : undefined;\n  const dayText =\n    daysRemaining > 0\n      ? `${daysRemaining} day${daysRemaining > 1 ? \"s\" : \"\"}`\n      : undefined;\n  return [yearText, weekText, dayText]\n    .filter((t) => t !== undefined)\n    .join(\", \");\n}\n","import * as d3 from \"d3\";\nimport _ from \"lodash\";\nimport { humanizeDate } from \"./datetimes\";\n\nexport function goodBadUglyColourKeyData(configLocation) {\n  return (vis, config, metadata) => {\n    const { good, bad, ugly, precision } = _.get(config, configLocation);\n    const scale = vis.colourScaleBuilder(config, metadata);\n\n    const goodBad = d3.interpolateNumber(good, bad);\n    const badUgly = d3.interpolateNumber(bad, ugly);\n    const key = [];\n    for (let ix = 0.0; ix < 1.0; ix += 0.1) {\n      let metric = goodBad(ix);\n      if (precision === 0) {\n        metric = Math.round(metric);\n      } else {\n        metric = metric.toFixed(precision);\n      }\n      key.push([metric, scale(metric)]);\n    }\n    for (let ix = 0.1; ix <= 1.0; ix += 0.1) {\n      let metric = badUgly(ix);\n      if (precision === 0) {\n        metric = Math.round(metric);\n      } else {\n        metric = metric.toFixed(precision);\n      }\n      key.push([metric, scale(metric)]);\n    }\n    return key;\n  };\n}\n\nexport function languageColourKeyData(vis, config, metadata) {\n  const { languageKey, otherColour } = metadata.languages;\n  return [\n    ...languageKey.map((k) => [k.language, k.colour]),\n    [\"Other languages\", otherColour],\n  ];\n}\n\nexport function depthKeyData(vis, config, metadata) {\n  const { maxDepth } = metadata.stats;\n  const scale = vis.colourScaleBuilder(config, metadata);\n  const key = [];\n  for (let ix = 1; ix <= maxDepth; ix += 1) {\n    key.push([ix, scale(ix)]);\n  }\n  return key;\n}\n\nexport function creationKeyData(vis, config, metadata) {\n  const scale = vis.colourScaleBuilder(config, metadata);\n  const {\n    dateRange: { earliest, latest },\n  } = config;\n  const dateRange = latest - earliest;\n\n  const keyText = (value) => `${humanizeDate(value)}`;\n\n  const key = [[\"Outside date range\", config.colours.neutralColour]];\n  for (let ix = 0; ix <= 20; ix += 1) {\n    const age = earliest + Math.floor((ix * dateRange) / 20);\n    key.push([keyText(age), scale(age)]);\n  }\n  return key;\n}\n\nexport function numberOfChangersKeyData(vis, config, metadata) {\n  const scale = vis.colourScaleBuilder(config, metadata);\n  const { numberOfChangers } = config;\n  const key = [\n    [\"None\", numberOfChangers.noChangersColour],\n    [\"One\", numberOfChangers.oneChangerColour],\n  ];\n  for (\n    let i = numberOfChangers.fewChangersMin;\n    i < numberOfChangers.fewChangersMax;\n    i += 1\n  ) {\n    key.push([i, scale(i)]);\n  }\n  const scaleIncrement =\n    (numberOfChangers.manyChangersMax - numberOfChangers.fewChangersMax) / 10;\n  for (\n    let n = numberOfChangers.fewChangersMax;\n    n <= numberOfChangers.manyChangersMax;\n    n += scaleIncrement\n  ) {\n    key.push([Math.round(n), scale(n)]);\n  }\n  return key;\n}\n","import React from \"react\";\nimport {\n  nodeAge,\n  nodeChurnCommits,\n  nodeChurnDays,\n  nodeChurnLines,\n  nodeCreationDateClipped,\n  nodeCumulativeLinesOfCode,\n  nodeDepth,\n  nodeIndentationP99,\n  nodeIndentationStddev,\n  nodeIndentationSum,\n  nodeLanguage,\n  nodeNumberOfChangers,\n} from \"./nodeData\";\nimport {\n  depthScaleBuilder,\n  earlyLateScaleBuilder,\n  goodBadUglyScaleBuilder,\n  languageScaleBuilder,\n  numberOfChangersScale,\n} from \"./ColourScales\";\nimport standardFillBuilder from \"./fillFunctions\";\nimport {\n  creationKeyData,\n  depthKeyData,\n  goodBadUglyColourKeyData,\n  languageColourKeyData,\n  numberOfChangersKeyData,\n} from \"./colourKeys\";\n\nconst blankParent = () => undefined;\n\nconst VisualizationData = {\n  language: {\n    displayOrder: 0,\n    title: \"Programming Language\",\n    subVis: false,\n    help: <p>Shows the most common programming languages</p>,\n    dataFn: nodeLanguage,\n    parentFn: blankParent,\n    fillFnBuilder: standardFillBuilder,\n    colourScaleBuilder: languageScaleBuilder,\n    colourKeyBuilder: languageColourKeyData,\n  },\n  loc: {\n    displayOrder: 1,\n    title: \"Lines of Code\",\n    subVis: false,\n    help: (\n      <div>\n        <p>\n          Large lines of code has been shown to be strongly correlated with\n          complexity. Good code &ldquo;fits in your head&rdquo;.\n        </p>\n        <p>\n          Note that the map has areas roughly proportional to lines of code, but\n          the voronoi power map isn&apos;t perfect and areas may be distorted\n        </p>\n      </div>\n    ),\n    dataFn: nodeCumulativeLinesOfCode,\n    parentFn: blankParent,\n    fillFnBuilder: standardFillBuilder,\n    colourScaleBuilder: goodBadUglyScaleBuilder([\"loc\"]),\n    colourKeyBuilder: goodBadUglyColourKeyData([\"loc\"]),\n  },\n  depth: {\n    displayOrder: 2,\n    title: \"Nesting depth\",\n    subVis: false,\n    help: <p>Shows nesting depth in the directory structure</p>,\n    dataFn: nodeDepth,\n    parentFn: nodeDepth,\n    fillFnBuilder: standardFillBuilder,\n    colourScaleBuilder: depthScaleBuilder,\n    colourKeyBuilder: depthKeyData,\n  },\n  indentation: {\n    displayOrder: 3,\n    title: \"Indentation\",\n    subVis: true,\n    defaultChild: \"stddev\",\n    children: {\n      sum: {\n        title: \"Total area\",\n        displayOrder: 0,\n        help: (\n          <div>\n            <p>\n              Code indentation can be correlated with complexity - though\n              inconsistent formatting can mess this up. Tabs are assumed to be 4\n              spaces.\n            </p>\n            <p>\n              This visualisation shows the total area - the sum of the\n              indentation of all lines. It will highlight large files, which are\n              often the source of issues.\n            </p>\n          </div>\n        ),\n        dataFn: nodeIndentationSum,\n        parentFn: blankParent,\n        fillFnBuilder: standardFillBuilder,\n        colourScaleBuilder: goodBadUglyScaleBuilder([\"indentation\", \"sum\"]),\n        colourKeyBuilder: goodBadUglyColourKeyData([\"indentation\", \"sum\"]),\n      },\n      p99: {\n        title: \"Worst indentation\",\n        displayOrder: 1,\n        help: (\n          <div>\n            <p>\n              Code indentation can be correlated with complexity - though\n              inconsistent formatting can mess this up. Tabs are assumed to be 4\n              spaces.\n            </p>\n            <p>\n              This visualisation shows the worst indentation (the 99th\n              percentile) of each file. It is better for spotting specific\n              problems than overall complexity.\n            </p>\n          </div>\n        ),\n        dataFn: nodeIndentationP99,\n        parentFn: blankParent,\n        fillFnBuilder: standardFillBuilder,\n        colourScaleBuilder: goodBadUglyScaleBuilder([\"indentation\", \"p99\"]),\n        colourKeyBuilder: goodBadUglyColourKeyData([\"indentation\", \"p99\"]),\n      },\n      stddev: {\n        title: \"Standard deviation\",\n        displayOrder: 2,\n        help: (\n          <div>\n            <p>\n              Code indentation can be correlated with complexity - though\n              inconsistent formatting can mess this up. Tabs are assumed to be 4\n              spaces.\n            </p>\n            <p>\n              This visualisation shows the standard deviation of indentations -\n              it is a good indicator for complexity hot-spots.\n            </p>\n          </div>\n        ),\n        dataFn: nodeIndentationStddev,\n        parentFn: blankParent,\n        fillFnBuilder: standardFillBuilder,\n        colourScaleBuilder: goodBadUglyScaleBuilder([\"indentation\", \"stddev\"]),\n        colourKeyBuilder: goodBadUglyColourKeyData([\"indentation\", \"stddev\"]),\n      },\n    },\n  },\n  age: {\n    displayOrder: 4,\n    title: \"Age of last change\",\n    subVis: false,\n    help: (\n      <div>\n        <p>Highlights code which has had no changes for some time.</p>\n        <p>\n          This may indicate code which has not been touched or refactored in a\n          long time, indicating lost knowledge\n        </p>\n        <p>It may also indicate code that is stable and bug-free</p>\n        <p>\n          The real meaning may depend on development culture, and quality of\n          testing\n        </p>\n      </div>\n    ),\n    dataFn: nodeAge,\n    parentFn: blankParent,\n    fillFnBuilder: standardFillBuilder,\n    colourScaleBuilder: goodBadUglyScaleBuilder([\"age\"]),\n    colourKeyBuilder: goodBadUglyColourKeyData([\"age\"]),\n  },\n  creation: {\n    displayOrder: 5,\n    title: \"Creation date\",\n    subVis: false,\n    help: (\n      <div>\n        <p>\n          Creation date - only shows files created in the selected date range\n        </p>\n        <p>\n          This isn&apos;t really related to quality, but is useful for\n          visualizing code history\n        </p>\n        <p>\n          Note that this is not a true historical view - the layout doesn&apos;t\n          change with changing time scales, and deleted files aren&apos;t shown\n          even if you select past dates.\n        </p>\n      </div>\n    ),\n    dataFn: nodeCreationDateClipped,\n    parentFn: blankParent,\n    fillFnBuilder: standardFillBuilder,\n    colourScaleBuilder: earlyLateScaleBuilder,\n    colourKeyBuilder: creationKeyData,\n  },\n  numberOfChangers: {\n    displayOrder: 6,\n    title: \"Number of unique changers\",\n    subVis: false,\n    help: (\n      <div>\n        <p>\n          Shows unique changers in selected date range. Too few changers might\n          indicate lack of shared understanding of code. Too many changers might\n          indicate poorly designed code that has too many concerns and needs\n          constant change.\n        </p>\n        <p>\n          Note currently there is no way to distinguish one user with multiple\n          logins from multiple people!\n        </p>\n      </div>\n    ),\n    dataFn: nodeNumberOfChangers,\n    parentFn: blankParent,\n    fillFnBuilder: standardFillBuilder,\n    colourScaleBuilder: numberOfChangersScale,\n    colourKeyBuilder: numberOfChangersKeyData,\n  },\n  churn: {\n    displayOrder: 7,\n    title: \"Churn\",\n    subVis: true,\n    defaultChild: \"days\",\n    children: {\n      days: {\n        title: \"Days containing a change\",\n        displayOrder: 0,\n        help: (\n          <div>\n            <p>\n              Code Churn shows how often the code has changed in the selected\n              date range\n            </p>\n            <p>\n              This visualisation shows the proportion of days containing a\n              change, so a value of &ldquo;1&rdquo; means the code changed every\n              day.\n            </p>\n          </div>\n        ),\n        dataFn: nodeChurnDays,\n        parentFn: blankParent,\n        fillFnBuilder: standardFillBuilder,\n        colourScaleBuilder: goodBadUglyScaleBuilder([\"churn\", \"days\"]),\n        colourKeyBuilder: goodBadUglyColourKeyData([\"churn\", \"days\"]),\n      },\n      commits: {\n        title: \"Commits per day\",\n        displayOrder: 1,\n        help: (\n          <div>\n            <p>\n              Code Churn shows how often the code has changed in the selected\n              date range\n            </p>\n            <p>\n              This visualisation shows the number of commits per day, so a value\n              of &ldquo;0.1&rdquo; means the code was committed on average once\n              every ten days.\n            </p>\n          </div>\n        ),\n        dataFn: nodeChurnCommits,\n        parentFn: blankParent,\n        fillFnBuilder: standardFillBuilder,\n        colourScaleBuilder: goodBadUglyScaleBuilder([\"churn\", \"commits\"]),\n        colourKeyBuilder: goodBadUglyColourKeyData([\"churn\", \"commits\"]),\n      },\n      lines: {\n        title: \"Lines per day\",\n        displayOrder: 2,\n        help: (\n          <div>\n            <p>\n              Code Churn shows how often the code has changed in the selected\n              date range\n            </p>\n            <p>\n              This visualisation shows the number of lines changed per day, a\n              sum of additions and deletions, so a value of &ldquo;10&rdquo;\n              means ten lines of code were changed per day on average.\n            </p>\n            <p>\n              Note this is a pretty rough measure - if someone added 10 lines\n              then someone else deleted those 10 lines it will show up as a 20\n              line difference\n            </p>\n          </div>\n        ),\n        dataFn: nodeChurnLines,\n        parentFn: blankParent,\n        fillFnBuilder: standardFillBuilder,\n        colourScaleBuilder: goodBadUglyScaleBuilder([\"churn\", \"lines\"]),\n        colourKeyBuilder: goodBadUglyColourKeyData([\"churn\", \"lines\"]),\n      },\n    },\n  },\n};\n\nexport default VisualizationData;\n","/* eslint-disable react/prop-types */\nimport React from \"react\";\nimport styles from \"./ToggleablePanel.module.css\";\n\nconst ToggleablePanel = (props) => {\n  const {\n    showInitially,\n    title,\n    children,\n    showText = \"show\",\n    hideText = \"hide\",\n    borderlessIfHidden = false,\n  } = props;\n  const [showResults, setShowResults] = React.useState(showInitially);\n  const onClick = () => setShowResults(!showResults);\n  const hiddenBorderStyle = borderlessIfHidden\n    ? styles.borderless\n    : styles.hidden;\n  if (!showResults) {\n    return (\n      <div className={`${styles.panel} ${hiddenBorderStyle}`}>\n        <h4>\n          {title}{\" \"}\n          <button type=\"button\" onClick={onClick}>\n            {showText}\n          </button>\n        </h4>\n      </div>\n    );\n  }\n  return (\n    <div className={`${styles.panel} ${styles.shown}`}>\n      <h4>\n        {title}{\" \"}\n        <button type=\"button\" onClick={onClick}>\n          {hideText}\n        </button>\n      </h4>\n      {children}\n    </div>\n  );\n};\n\nexport default ToggleablePanel;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport ToggleablePanel from \"./ToggleablePanel\";\n\nconst HelpPanel = (props) => {\n  const { children } = props;\n  return (\n    <ToggleablePanel\n      title=\"\"\n      showInitially={false}\n      showText=\"help\"\n      borderlessIfHidden\n    >\n      {children}\n    </ToggleablePanel>\n  );\n};\n\nHelpPanel.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nexport default HelpPanel;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\n\nconst ColourKey = (props) => {\n  const { title, keyData } = props;\n  return (\n    <div>\n      <p>{title}</p>\n      <table>\n        <thead>\n          <tr>\n            <th>Value</th>\n            <th>Colour</th>\n          </tr>\n        </thead>\n        <tbody>\n          {keyData.map(([value, colour]) => {\n            return (\n              <tr>\n                <td>{value}</td>\n                <td\n                  className=\"colourSample\"\n                  style={{ backgroundColor: colour, width: \"4em\" }}\n                />\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    </div>\n  );\n};\nColourKey.propTypes = {\n  title: PropTypes.string.isRequired,\n  keyData: PropTypes.arrayOf(PropTypes.array).isRequired,\n};\nexport default ColourKey;\n","/* eslint-disable react/forbid-prop-types */\n\nimport React from \"react\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport ToggleablePanel from \"./ToggleablePanel\";\nimport HelpPanel from \"./HelpPanel\";\nimport { humanizeDate } from \"./datetimes\";\nimport ColourKey from \"./ColourKey\";\n\nconst VisColourKey = (props) => {\n  const { vis, config, metadata } = props;\n  const earliestDate = humanizeDate(config.dateRange.earliest);\n  const latestDate = humanizeDate(config.dateRange.latest);\n  const keyData = vis.colourKeyBuilder(vis, config, metadata);\n  return (\n    <div>\n      <HelpPanel>{vis.help}</HelpPanel>\n      <p>\n        From: {earliestDate} to {latestDate}\n      </p>\n      <ToggleablePanel title=\"Colour Key\" showInitially>\n        <ColourKey title=\"\" keyData={keyData} />\n      </ToggleablePanel>\n    </div>\n  );\n};\nVisColourKey.propTypes = defaultPropTypes;\nexport default VisColourKey;\n","// bucket calculations needed all over the place\n\nexport function allBuckets(couplingStats) {\n  const { bucketCount, bucketSize, firstBucketStart } = couplingStats;\n\n  const results = [];\n  for (let index = 0; index < bucketCount; index += 1) {\n    const start = firstBucketStart + index * bucketSize;\n    results.push({ index, start, end: start + bucketSize - 1 });\n  }\n  return results;\n}\nexport function bucketsSelected(couplingStats, earliest, latest) {\n  return allBuckets(couplingStats).filter((bucket) => {\n    if (bucket.start > latest) return false;\n    if (bucket.end < earliest) return false;\n    return true;\n  });\n}\n\nexport function couplingDateRange(couplingStats, earliest, latest) {\n  const buckets = bucketsSelected(couplingStats, earliest, latest);\n  const couplingStart = buckets[0].start;\n  const couplingEnd = buckets[buckets.length - 1].end;\n  return { couplingStart, couplingEnd };\n}\n","/* eslint-disable jsx-a11y/no-onchange */\n/* eslint-disable react/forbid-prop-types */\nimport React, { useRef } from \"react\";\nimport _uniqueId from \"lodash/uniqueId\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport ToggleablePanel from \"./ToggleablePanel\";\nimport HelpPanel from \"./HelpPanel\";\nimport { couplingDateRange } from \"./couplingBuckets\";\nimport { humanizeDate } from \"./datetimes\";\n\nconst CouplingController = (props) => {\n  const { dispatch, state, stats } = props;\n  const {\n    couplingConfig: {\n      couplingAvailable,\n      shown,\n      minRatio,\n      minDays,\n      maxCommonRoots,\n    },\n  } = state;\n  const { current: sliderId } = useRef(_uniqueId(\"coupling-controller-\"));\n  const { current: minDaysId } = useRef(_uniqueId(\"coupling-controller-\"));\n  const { current: maxRootsId } = useRef(_uniqueId(\"coupling-controller-\"));\n\n  if (!couplingAvailable) {\n    return (\n      <div>\n        <p>(no coupling data in source)</p>\n      </div>\n    );\n  }\n\n  const {\n    coupling: { bucketSize },\n  } = stats;\n  const { earliest, latest } = state.config.dateRange;\n\n  // TODO: debounce slider?  Tried using 'onInput' but 'onChange' fires on every change anyway\n\n  const bucketDays = bucketSize / (24 * 60 * 60);\n\n  const { couplingStart, couplingEnd } = couplingDateRange(\n    stats.coupling,\n    earliest,\n    latest\n  );\n\n  const showButton = shown ? (\n    <button\n      type=\"button\"\n      onClick={() =>\n        dispatch({\n          type: \"setShowCoupling\",\n          payload: false,\n        })\n      }\n    >\n      Hide coupling\n    </button>\n  ) : (\n    <button\n      type=\"button\"\n      onClick={() =>\n        dispatch({\n          type: \"setShowCoupling\",\n          payload: true,\n        })\n      }\n    >\n      Show coupling\n    </button>\n  );\n\n  const minMinDays = 5;\n  const maxMinDays = 30;\n\n  return (\n    <div>\n      <ToggleablePanel title=\"coupling controls\" showInitially={false}>\n        {showButton}\n        <HelpPanel>\n          <p>\n            Temporal coupling is based on git history - two files which\n            regularly change on the same day, may well have some kind of\n            coupling - explicit or implicit\n          </p>\n          <p>\n            The current calculation is fairly simple:\n            <br />\n            For each file, find what days it has changed in git.\n            <br />\n            Then count any other file which changes on some of those days.\n            <br />\n            For example if foo.rs changes on 20 days, and bar.rs changes on 18\n            of those days, it will show up as a coupling of 18/20 or 0.9.\n            <br />\n          </p>\n          <p>\n            This is a one-way relationship - foo.rs <i>may</i> have coupling\n            that means if bar.rs changes, foo.rs also has to change. The inverse\n            may not be true - bar.rs might change on 100 other days as well!\n          </p>\n          <p>\n            Be aware this can easily have false positives! For example, if\n            bar.rs is changed extremely regularly, it will look like a lot of\n            other files are coupled to it! You should probably consider\n            excluding bar.rs from your initial scan - it&apos;s probably not\n            normal source code. (there is no way to ignore it in the explorer\n            currently)\n          </p>\n          <p>Note there are some limits on coupling data stored, for sanity:</p>\n          <p>\n            Coupling is calculated in &ldquo;buckets&rdquo; of {bucketDays} days\n            each, so you can see coupling change over time. If you have multiple\n            buckets selected, the changes are averaged. Buckets will be shown on\n            the timescale below soon!\n          </p>\n          <p>\n            Coupling data is only stored for files with 10 changes in a coupling\n            bucket (by default, this is configurable) - this means files with a\n            low rate of change may not show coupling. This is hard to avoid,\n            lowering this filter can lead to a lot of false positives.\n          </p>\n          <p>\n            Coupling data is only stored if a ratio of 0.25 is observed (by\n            default, this is configurable)\n          </p>\n        </HelpPanel>\n        <p>\n          Coupling date range {humanizeDate(couplingStart)} to{\" \"}\n          {humanizeDate(couplingEnd)}\n        </p>\n        <label htmlFor={sliderId}>\n          Coupling Ratio: &nbsp;\n          {minRatio.toFixed(2)}\n          <input\n            id={sliderId}\n            type=\"range\"\n            min=\"0.25\"\n            max=\"1.0\"\n            step=\"0.01\"\n            value={minRatio}\n            onChange={(evt) => {\n              const value = Number.parseFloat(evt.target.value);\n\n              dispatch({ type: \"setMinCouplingRatio\", payload: value });\n            }}\n          />\n        </label>\n        <label htmlFor={minDaysId}>\n          Minimum days for coupling:\n          <select\n            name=\"minDays\"\n            id={minDaysId}\n            value={minDays}\n            onChange={(evt) =>\n              dispatch({\n                type: \"setCouplingMinDays\",\n                payload: Number.parseInt(evt.target.value, 10),\n              })\n            }\n          >\n            {[...Array(maxMinDays - minMinDays + 1).keys()].map((d) => {\n              const days = minMinDays + d;\n              return (\n                <option key={days} value={days}>\n                  {days}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n        <label htmlFor={maxRootsId}>\n          Filter coupling by distance:\n          <select\n            name=\"maxRoots\"\n            id={maxRootsId}\n            value={maxCommonRoots}\n            onChange={(evt) =>\n              dispatch({\n                type: \"setCouplingMaxCommonRoots\",\n                payload: Number.parseInt(evt.target.value, 10),\n              })\n            }\n          >\n            <option key=\"-1\" value=\"-1\">\n              No filter\n            </option>\n            <option key=\"0\" value=\"0\">\n              top-level directories\n            </option>\n            <option key=\"1\" value=\"1\">\n              0-1st level directories\n            </option>\n            <option key=\"2\" value=\"2\">\n              0-2nd level directories\n            </option>\n            <option key=\"3\" value=\"3\">\n              0-3rd level directories\n            </option>\n          </select>\n        </label>\n      </ToggleablePanel>\n    </div>\n  );\n};\n\nCouplingController.propTypes = defaultPropTypes;\n\nexport default CouplingController;\n","/* eslint-disable jsx-a11y/no-onchange */\n/* eslint-disable react/forbid-prop-types */\nimport React, { useRef } from \"react\";\nimport _uniqueId from \"lodash/uniqueId\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport VisualizationData from \"./visualizationData\";\nimport VisColourKey from \"./VisColourKey\";\nimport CouplingController from \"./CouplingController\";\nimport { humanizeDate } from \"./datetimes\";\n\nconst Controller = (props) => {\n  const { dataRef, state, dispatch } = props;\n  const { metadata } = dataRef.current;\n  const { maxDepth } = metadata.stats;\n  const { config } = state;\n  const { currentTheme } = config.colours;\n  const { earliest, latest } = state.config.dateRange;\n  // ID logic from https://stackoverflow.com/questions/29420835/how-to-generate-unique-ids-for-form-labels-in-react\n  const { current: vizId } = useRef(_uniqueId(\"controller-\"));\n  const { current: depthId } = useRef(_uniqueId(\"controller-\"));\n  const { current: subVizId } = useRef(_uniqueId(\"controller-\"));\n\n  const sortedVis = Object.entries(VisualizationData).sort(\n    ([k1, v1], [k2, v2]) => k2.displayOrder - k1.displayOrder\n  );\n  const currentParentVisData = VisualizationData[state.config.visualization];\n  const currentSubVisData = currentParentVisData.subVis\n    ? currentParentVisData.children[state.config.subVis]\n    : undefined;\n  const sortedSubVis = currentParentVisData.subVis\n    ? Object.entries(currentParentVisData.children).sort(\n        ([k1, v1], [k2, v2]) => k2.displayOrder - k1.displayOrder\n      )\n    : undefined;\n\n  const currentVisOrSub = currentSubVisData || currentParentVisData;\n\n  const themeButton = currentTheme === 'dark' ? (\n    <button\n      type=\"button\"\n      onClick={() =>\n        dispatch({\n          type: \"setTheme\",\n          payload: \"light\",\n        })\n      }\n    >\n      Light theme\n    </button>\n  ) : (\n    <button\n      type=\"button\"\n      onClick={() =>\n        dispatch({\n          type: \"setTheme\",\n          payload: \"dark\",\n        })\n      }\n    >\n      Dark theme\n    </button>\n  );\n\n  return (\n    <aside className=\"Controller\">\n      <div>\n        <p>\n          Selected date range {humanizeDate(earliest)} to {humanizeDate(latest)}\n        </p>\n        <label htmlFor={depthId}>\n          Display maximum depth:\n          <select\n            id={depthId}\n            value={state.expensiveConfig.depth}\n            onChange={(evt) =>\n              dispatch({\n                type: \"setDepth\",\n                payload: Number.parseInt(evt.target.value, 10),\n              })\n            }\n          >\n            {[...Array(maxDepth + 1).keys()].map((d) => (\n              <option key={d} value={d}>\n                {d}\n              </option>\n            ))}\n          </select>\n        </label>\n      </div>\n      <CouplingController\n        dispatch={dispatch}\n        state={state}\n        stats={metadata.stats}\n      />\n      <div>\n        <label htmlFor={vizId}>\n          Visualization:\n          <select\n            id={vizId}\n            value={state.config.visualization}\n            onChange={(evt) =>\n              dispatch({ type: \"setVisualization\", payload: evt.target.value })\n            }\n          >\n            {sortedVis.map(([key, vis]) => (\n              <option value={key}>{vis.title}</option>\n            ))}\n          </select>\n        </label>\n      </div>\n      {currentParentVisData.subVis ? (\n        <div>\n          <label htmlFor={subVizId}>\n            Sub-visualisation:\n            <select\n              id={subVizId}\n              value={state.config.subVis}\n              onChange={(evt) =>\n                dispatch({\n                  type: \"setSubVisualization\",\n                  payload: evt.target.value,\n                })\n              }\n            >\n              {sortedSubVis.map(([key, vis]) => (\n                <option value={key}>{vis.title}</option>\n              ))}\n            </select>\n          </label>\n        </div>\n      ) : (\n        \"\"\n      )}\n      <VisColourKey vis={currentVisOrSub} config={config} metadata={metadata} />\n      {themeButton}\n    </aside>\n  );\n};\n\nController.propTypes = defaultPropTypes;\n\nexport default Controller;\n","/* eslint-disable react/forbid-prop-types */\n\nimport React from \"react\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport styles from \"./PathInspector.module.css\";\nimport ToggleablePanel from \"./ToggleablePanel\";\n\nconst PathInspector = (props) => {\n  const { node, dispatch } = props;\n\n  let parents = [];\n  let currentNode = node.parent;\n  while (currentNode.parent) {\n    // deliberately don't show root\n    parents.push(currentNode);\n    currentNode = currentNode.parent;\n  }\n  parents = parents.reverse();\n\n  return (\n    <ToggleablePanel title=\"Path\" showInitially>\n      <ul className={styles.pathlist}>\n        {parents.map((parent) => (\n          <li key={parent.data.path}>\n            <button\n              type=\"button\"\n              onClick={() =>\n                dispatch({\n                  type: \"selectNode\",\n                  payload: parent,\n                })\n              }\n            >\n              {parent.data.name}\n            </button>\n          </li>\n        ))}\n      </ul>\n    </ToggleablePanel>\n  );\n};\nPathInspector.propTypes = defaultPropTypes;\nexport default PathInspector;\n","/* eslint-disable react/forbid-prop-types */\n\nimport React from \"react\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport ToggleablePanel from \"./ToggleablePanel\";\nimport { nodeCouplingFilesFiltered } from \"./nodeData\";\nimport { couplingDateRange } from \"./couplingBuckets\";\nimport { humanizeDate } from \"./datetimes\";\n\nconst CouplingInspector = (props) => {\n  const { node, state, stats } = props;\n  const { earliest, latest } = state.config.dateRange;\n  const { couplingConfig } = state;\n\n  const { couplingStart, couplingEnd } = couplingDateRange(\n    stats.coupling,\n    earliest,\n    latest\n  );\n\n  let files = nodeCouplingFilesFiltered(\n    node,\n    earliest,\n    latest,\n    couplingConfig.minRatio,\n    couplingConfig.minDays,\n    couplingConfig.maxCommonRoots\n  );\n  // this is ugly - but we can't return early if no coupling data\n  //  or the toggleablepanel state gets lost when you change nodes!\n\n  let title;\n  let couplingDetails;\n  if (files === undefined || files.length === 0) {\n    title = (\n      <h5>\n        No coupling data in range {humanizeDate(couplingStart)} to\n        {humanizeDate(couplingEnd)}\n      </h5>\n    );\n    couplingDetails = <div />;\n  } else {\n    const { sourceCount } = files[0];\n    files.sort((f1, f2) => f2.targetCount - f1.targetCount);\n    files = files.slice(0, 20);\n    title = (\n      <h5>\n        Source days: {sourceCount} in range {humanizeDate(couplingStart)} to\n        {humanizeDate(couplingEnd)}\n      </h5>\n    );\n    couplingDetails = (\n      <table>\n        <thead>\n          <tr>\n            <td>File</td>\n            <td>Matching days</td>\n            <td>Ratio</td>\n          </tr>\n        </thead>\n        <tbody>\n          {files.map((file) => {\n            const ratio = file.targetCount / file.sourceCount;\n            return (\n              <tr>\n                <td>{file.targetFile}</td>\n                <td>{file.targetCount}</td>\n                {ratio.toFixed(3)}\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n    );\n  }\n\n  return (\n    <ToggleablePanel title=\"Coupling\" showInitially={false}>\n      {title}\n      {couplingDetails}\n    </ToggleablePanel>\n  );\n};\n\nCouplingInspector.propTypes = defaultPropTypes;\n\nexport default CouplingInspector;\n","/* eslint-disable react/forbid-prop-types */\n\nimport React from \"react\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport PathInspector from \"./PathInspector\";\nimport CouplingInspector from \"./CouplingInspector\";\nimport {\n  nodeAge,\n  nodeChurnData,\n  nodeCreationDate,\n  nodeIndentationData,\n  nodeLastCommitDay,\n  nodeLocData,\n  nodeNumberOfChangers,\n  nodeRemoteHead,\n  nodeRemoteUrl,\n  nodeTopChangers,\n} from \"./nodeData\";\nimport { humanizeDate, humanizeDays } from \"./datetimes\";\nimport ToggleablePanel from \"./ToggleablePanel\";\n\nfunction findGitUrl(node) {\n  let suffix = node.data.name;\n  let current = node;\n  while (!nodeRemoteUrl(current) && current.parent) {\n    current = current.parent;\n    if (!nodeRemoteUrl(current)) {\n      suffix = `${current.data.name}/${suffix}`;\n    }\n  }\n  let remote = nodeRemoteUrl(current);\n\n  if (remote) {\n    const sshRemoteRe = /\\w+@([^:]+):([a-zA-Z./]+)/; // ssh login not http(s) url\n    if (sshRemoteRe.test(remote)) {\n      remote = remote.replace(sshRemoteRe, \"https://$1/$2\");\n    }\n    // TODO: these could be regex magic?\n    if (remote.startsWith(\"git://\")) {\n      remote = `https://${remote.substr(6, remote.length)}`;\n    }\n    if (remote.endsWith(\".git\")) {\n      remote = remote.substr(0, remote.length - 4);\n    }\n    const head = nodeRemoteHead(current);\n    if (head) {\n      return `${remote}/blob/${head}/${suffix}`;\n    }\n    return `${remote}/blob/master/${suffix}`;\n  }\n  return undefined;\n}\n\nfunction churnReport(churnData) {\n  if (!churnData) return \"\";\n  const {\n    totalLines,\n    totalCommits,\n    totalDays,\n    fractionalLines,\n    fractionalCommits,\n    fractionalDays,\n  } = churnData;\n  return (\n    <ToggleablePanel title=\"Code Churn\" showInitially={false}>\n      <table>\n        <thead>\n          <tr>\n            <th>Metric</th>\n            <th>Total</th>\n            <th>Per day</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td>Days with a change</td>\n            <td>{totalDays}</td>\n            <td>{fractionalDays.toFixed(4)}</td>\n          </tr>\n          <tr>\n            <td>Commits</td>\n            <td>{totalCommits}</td>\n            <td>{fractionalCommits.toFixed(4)}</td>\n          </tr>\n          <tr>\n            <td>Lines</td>\n            <td>{totalLines}</td>\n            <td>{fractionalLines.toFixed(2)}</td>\n          </tr>\n        </tbody>\n      </table>\n    </ToggleablePanel>\n  );\n}\n\nconst NodeInspector = (props) => {\n  const { node, dispatch, state, metadata } = props;\n  const { stats } = metadata;\n  const locData = nodeLocData(node);\n  const indentationData = nodeIndentationData(node);\n  const gitUrl = findGitUrl(node);\n  const { earliest, latest } = state.config.dateRange;\n  const { topChangersCount } = state.config.numberOfChangers;\n  const { couplingAvailable } = state.couplingConfig;\n  const age = nodeAge(node, earliest, latest);\n  const lastCommit = nodeLastCommitDay(node, earliest, latest);\n  const creationDate = nodeCreationDate(node, earliest, latest);\n  let creationText = creationDate\n    ? `File created on ${humanizeDate(creationDate)}`\n    : \"\";\n  if (creationDate && creationDate > latest) {\n    creationText += \" (after current date selection)\";\n  }\n  const ageText = age\n    ? `file last changed ${age} days ago on ${humanizeDate(\n        lastCommit\n      )} (${humanizeDays(age)})`\n    : \"\";\n  const changerCount = nodeNumberOfChangers(node, earliest, latest);\n  const topChangers = nodeTopChangers(node, earliest, latest, topChangersCount);\n  const userName = (userId) => {\n    const { user } = metadata.users[userId];\n    if (user.name) {\n      if (user.email) {\n        return `${user.name} / ${user.email}`;\n      }\n      return user.name;\n    }\n    return user.email;\n  };\n  const topChangerTable =\n    topChangers && topChangers.length > 0 ? (\n      <div>\n        <h5>Top {topChangersCount} changers:</h5>\n        <table>\n          <thead>\n            <tr>\n              <th>User</th>\n              <th>Change count</th>\n            </tr>\n          </thead>\n          <tbody>\n            {topChangers.map(([user, count]) => {\n              return (\n                <tr>\n                  <td>{userName(user)}</td>\n                  <td>{count}</td>\n                </tr>\n              );\n            })}\n          </tbody>\n        </table>\n      </div>\n    ) : (\n      \"\"\n    );\n\n  const churnData = nodeChurnData(node, earliest, latest);\n\n  return (\n    <div>\n      {gitUrl ? (\n        <h3>\n          {node.data.name}&nbsp;\n          <a href={gitUrl} target=\"#\">\n            (remote code)\n          </a>\n        </h3>\n      ) : (\n        <h3>{node.data.name}</h3>\n      )}\n      <PathInspector node={node} dispatch={dispatch} />\n      <p>\n        Selected date range {humanizeDate(earliest)} to {humanizeDate(latest)}\n      </p>\n      <ToggleablePanel title=\"basic stats\" showInitially>\n        <p>File type: {locData.language}</p>\n        <p>Lines of code: {locData.code}</p>\n        {creationDate ? (\n          <p>{creationText}</p>\n        ) : (\n          \"(not created in selected range)\"\n        )}\n        {age ? <p>{ageText}</p> : \"\"}\n      </ToggleablePanel>\n      {indentationData ? (\n        <ToggleablePanel title=\"Indentation\" showInitially={false}>\n          <ul>\n            <li>stddev: {indentationData.stddev}</li>\n            <li>p90: {indentationData.p90}</li>\n            <li>worst: {indentationData.p99}</li>\n            <li>area: {indentationData.sum}</li>\n          </ul>\n        </ToggleablePanel>\n      ) : (\n        \"\"\n      )}\n      <ToggleablePanel title=\"file changers\" showInitially={false}>\n        {changerCount ? <h5>Unique changers: {changerCount}</h5> : \"\"}\n        {topChangerTable}\n      </ToggleablePanel>\n      {churnReport(churnData)}\n      {couplingAvailable ? (\n        <CouplingInspector\n          node={node}\n          dispatch={dispatch}\n          state={state}\n          stats={stats}\n        />\n      ) : (\n        \"\"\n      )}\n    </div>\n  );\n};\n\nNodeInspector.propTypes = defaultPropTypes;\n\nexport default NodeInspector;\n","/* eslint-disable react/forbid-prop-types */\n\nimport React from \"react\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport PathInspector from \"./PathInspector\";\nimport { nodeCumulativeLinesOfCode } from \"./nodeData\";\n\nconst DirectoryNodeInspector = (props) => {\n  const { node, dispatch } = props;\n  const loc = nodeCumulativeLinesOfCode(node);\n  return (\n    <div>\n      <h3>{node.data.name}</h3>\n      <p>Directory:</p>\n      <PathInspector node={node} dispatch={dispatch} />\n      <p>Cumulative Lines of code: {loc}</p>\n    </div>\n  );\n};\nDirectoryNodeInspector.propTypes = defaultPropTypes;\nexport default DirectoryNodeInspector;\n","/* eslint-disable react/forbid-prop-types */\n\nimport React from \"react\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport NodeInspector from \"./NodeInspector\";\nimport DirectoryNodeInspector from \"./DirectoryNodeInspector\";\nimport { isDirectory } from \"./nodeData\";\n\nconst Inspector = (props) => {\n  // console.log(\"inspector props\", props);\n  const { state, dispatch, dataRef } = props;\n  const { metadata } = dataRef.current;\n  const { selectedNode } = state.config;\n  const hasSelection = selectedNode != null;\n  const showDirectory = hasSelection && isDirectory(selectedNode);\n  const nodeInspector = showDirectory ? (\n    <DirectoryNodeInspector\n      node={selectedNode}\n      state={state}\n      dispatch={dispatch}\n      metadata={metadata}\n    />\n  ) : (\n    <NodeInspector\n      node={selectedNode}\n      state={state}\n      metadata={metadata}\n      dispatch={dispatch}\n    />\n  );\n  return (\n    <aside className=\"Inspector\">\n      {hasSelection ? (\n        nodeInspector\n      ) : (\n        <div>\n          <p>Please click on the chart to select a file/folder</p>\n          <p>\n            <i>\n              <b>Note </b>\n            </i>\n            there is a date selector at the bottom of the diagram!\n          </p>\n        </div>\n      )}\n    </aside>\n  );\n};\nInspector.propTypes = defaultPropTypes;\nexport default Inspector;\n","/* eslint-disable react/forbid-prop-types */\n\nimport React, { useEffect, useRef } from \"react\";\nimport * as d3 from \"d3\";\nimport _ from \"lodash\";\nimport defaultPropTypes from \"./defaultPropTypes\";\nimport { dateToUnix, unixToDate } from \"./datetimes\";\nimport VisualizationData from \"./visualizationData\";\nimport {\n  nodeDescendants,\n  nodeCenter,\n  nodeHasCouplingData,\n  nodeCouplingFilesFiltered,\n  nodePath,\n} from \"./nodeData\";\n\n// TODO: should this live in Visualization.js ?\nfunction getCurrentVis(config) {\n  const vis = VisualizationData[config.visualization];\n\n  let selected = vis;\n  if (vis.subVis) {\n    if (config.subVis) {\n      selected = vis.children[config.subVis];\n    } else {\n      // can this happen?\n      console.warn(\"No config.subVis selected - using default\");\n      selected = vis.children[vis.defaultChild];\n    }\n  }\n  return selected;\n}\n\nconst redrawPolygons = (svgSelection, metadata, state) => {\n  const { config } = state;\n\n  const { fillFnBuilder, colourScaleBuilder, dataFn, parentFn } = getCurrentVis(\n    config\n  );\n  const scale = colourScaleBuilder(config, metadata);\n  const fillFn = fillFnBuilder(config, scale, dataFn, parentFn);\n\n  const strokeWidthFn = (d) => {\n    if (d.data.layout.algorithm === \"circlePack\") return 0;\n    return d.depth < 4 ? 4 - d.depth : 1;\n  };\n\n  return svgSelection\n    .attr(\"d\", (d) => {\n      return `${d3.line()(d.data.layout.polygon)}z`;\n    })\n    .style(\"fill\", fillFn)\n    .style(\"stroke\", config.colours[config.colours.currentTheme].defaultStroke)\n    .style(\"stroke-width\", strokeWidthFn)\n    .style(\"vector-effect\", \"non-scaling-stroke\"); // so zooming doesn't make thick lines\n};\n\nconst redrawSelection = (svgSelection, state) => {\n  const { config } = state;\n\n  const strokeWidthFn = (d) => {\n    if (d.data.layout.algorithm === \"circlePack\") return 0;\n    return d.depth < 4 ? 4 - d.depth : 1;\n  };\n\n  return svgSelection\n    .attr(\"d\", (d) => {\n      return `${d3.line()(d.data.layout.polygon)}z`;\n    })\n    .style(\"stroke-width\", strokeWidthFn)\n    .style(\"stroke\", config.colours[config.colours.currentTheme].selectedStroke)\n    .style(\"fill\", \"none\")\n    .style(\"vector-effect\", \"non-scaling-stroke\"); // so zooming doesn't make thick lines\n};\n\nfunction findSelectionPath(data, state) {\n  if (!state.config.selectedNode) return [];\n  let node = state.config.selectedNode;\n  const results = [];\n  while (node.parent) {\n    results.push(node);\n    node = node.parent;\n  }\n  results.push(node);\n  return results.reverse();\n}\n\nconst update = (d3Container, files, metadata, state) => {\n  if (!d3Container.current) {\n    throw Error(\"No current container\");\n  }\n  const vizEl = d3Container.current;\n  const svg = d3.select(vizEl);\n  redrawPolygons(svg.selectAll(\".cell\"), metadata, state);\n\n  // TODO: DRY this up - or should selecting just be expensive config?\n  const selectionPath = findSelectionPath(files, state);\n  const group = svg.selectAll(\".topGroup\");\n  const selectionNodes = group\n    .selectAll(\".selected\")\n    .data(selectionPath, (node) => node.path);\n\n  const newSelectionNodes = selectionNodes\n    .enter()\n    .append(\"path\")\n    .classed(\"selected\", true);\n\n  redrawSelection(selectionNodes.merge(newSelectionNodes), state);\n  selectionNodes.exit().remove();\n};\n\n// flatten out all nodes for coupling line display\nfunction normalizedCouplingNodes(rootNode, state) {\n  const { config, couplingConfig } = state;\n  const {\n    dateRange: { earliest, latest },\n  } = config;\n  return couplingConfig.shown === false\n    ? []\n    : nodeDescendants(rootNode)\n        .filter(nodeHasCouplingData)\n        .map((d) =>\n          nodeCouplingFilesFiltered(\n            d,\n            earliest,\n            latest,\n            couplingConfig.minRatio,\n            couplingConfig.minDays,\n            couplingConfig.maxCommonRoots\n          )\n        )\n        .flat();\n}\n\nfunction arcPath(leftHand, source, target) {\n  const x1 = leftHand ? source[0] : target[0];\n  const y1 = leftHand ? source[1] : target[1];\n  const x2 = leftHand ? target[0] : source[0];\n  const y2 = leftHand ? target[1] : source[1];\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  const dr = Math.sqrt(dx * dx + dy * dy);\n  const sweep = leftHand ? 0 : 1;\n  const xRotation = 0;\n  const largeArc = 0;\n\n  return `M${x1},${y1}A${dr}, ${dr} ${xRotation}, ${largeArc}, ${sweep} ${x2},${y2}`;\n}\n\nfunction drawCoupling(group, files, metadata, state, dispatch) {\n  const { config } = state;\n  const { nodesByPath } = metadata;\n  const allCouplingNodes = normalizedCouplingNodes(files, state);\n\n  const couplingNodes = group\n    .selectAll(\".coupling\")\n    .data(allCouplingNodes, (node) => [node.source.path, node.targetFile]);\n\n  // TODO - consider reworking this with d3.join which seems to be the new hotness?\n  const newCouplingNodes = couplingNodes\n    .enter()\n    .append(\"path\")\n    .classed(\"coupling\", true);\n\n  const couplingLine = (d) => {\n    const sourcePos = nodeCenter(d.source);\n    const target = nodesByPath[d.targetFile];\n    const targetPos = nodeCenter(target);\n\n    return arcPath(true, sourcePos, targetPos);\n    // return `${d3.line()([sourcePos, targetPos])}`;\n  };\n\n  const couplingLineStroke = (d) => {\n    const colour = d3.color(\n      config.colours[config.colours.currentTheme].couplingStroke\n    );\n    const ratio = d.targetCount / d.sourceCount;\n    colour.opacity = ratio;\n    return colour;\n  };\n\n  const couplingLineWidth = (d) => {\n    const ratio = d.targetCount / d.sourceCount;\n    if (ratio >= 0.95) return \"3px\";\n    if (ratio > 0.8) return \"2px\";\n    return \"1px\";\n  };\n\n  const couplingLabel = (d) => {\n    const ratio = d.targetCount / d.sourceCount;\n    const from = nodePath(d.source);\n    return `${from} -> ${d.targetFile} (${ratio.toFixed(3)})`;\n  };\n\n  couplingNodes\n    .merge(newCouplingNodes)\n    .attr(\"d\", couplingLine)\n    .attr(\"marker-end\", \"url(#arrow)\") // sadly the marker colour is fixed!\n    .style(\"stroke\", couplingLineStroke)\n    .style(\"stroke-width\", couplingLineWidth)\n    .style(\"fill\", \"none\")\n    .style(\"vector-effect\", \"non-scaling-stroke\")\n    .on(\"click\", (node, i, nodeList) => {\n      console.log(\"onClicked\", node, i, nodeList[i]);\n      dispatch({ type: \"selectNode\", payload: node.source.hierarchNode });\n    })\n    .append(\"svg:title\")\n    .text(couplingLabel); // so zooming doesn't make thick lines\n\n  couplingNodes.exit().remove();\n}\n\nconst updateCoupling = (d3Container, files, metadata, state, dispatch) => {\n  if (!d3Container.current) {\n    throw Error(\"No current container\");\n  }\n  const vizEl = d3Container.current;\n  const svg = d3.select(vizEl);\n  const group = svg.selectAll(\".topGroup\");\n  drawCoupling(group, files, metadata, state, dispatch);\n};\n\nconst draw = (d3Container, files, metadata, state, dispatch) => {\n  const { config, expensiveConfig } = state;\n  const {\n    layout: { timescaleHeight },\n  } = config;\n\n  if (!d3Container.current) {\n    console.warn(\"in draw but d3container not yet current\");\n    return;\n  }\n  const vizEl = d3Container.current;\n  const w = vizEl.clientWidth;\n  const h = vizEl.clientHeight - timescaleHeight;\n\n  const { layout } = files;\n  const svg = d3\n    .select(vizEl)\n    .attr(\"viewBox\", [\n      -layout.width / 2,\n      -layout.height / 2,\n      layout.width,\n      layout.height,\n    ]);\n  const group = svg.selectAll(\".topGroup\");\n  const rootNode = d3.hierarchy(files); // .sum(d => d.value);\n\n  // ugly - we cross-link each node to the hierarchy node, because so much needs hierarchy nodes.\n  // some time this should be fixed properly\n  rootNode.descendants().forEach((node) => {\n    node.data.hierarchNode = node;\n  });\n\n  // note we filter out nodes that are parents who will be hidden by their children, for speed\n  // so only show parent nodes at the clipping level.\n  const allNodes = rootNode\n    .descendants()\n    .filter((d) => d.depth <= expensiveConfig.depth)\n    .filter(\n      (d) => d.children === undefined || d.depth === expensiveConfig.depth\n    );\n\n  const nodes = group.selectAll(\".cell\").data(allNodes, (node) => node.path);\n\n  // TODO - consider reworking this with d3.join which seems to be the new hotness?\n  const newNodes = nodes.enter().append(\"path\").classed(\"cell\", true);\n\n  redrawPolygons(nodes.merge(newNodes), metadata, state)\n    // eslint-disable-next-line no-unused-vars\n    .on(\"click\", (node, i, nodeList) => {\n      // console.log(\"onClicked\", node, i, nodeList[i]);\n      dispatch({ type: \"selectNode\", payload: node });\n    })\n    .append(\"svg:title\")\n    .text((n) => n.data.path);\n\n  nodes.exit().remove();\n\n  const selectionPath = findSelectionPath(files, state);\n  const selectionNodes = group\n    .selectAll(\".selected\")\n    .data(selectionPath, (node) => node.path);\n\n  const newSelectionNodes = selectionNodes\n    .enter()\n    .append(\"path\")\n    .classed(\"selected\", true);\n\n  redrawSelection(selectionNodes.merge(newSelectionNodes), state);\n\n  selectionNodes.exit().remove();\n\n  drawCoupling(group, files, metadata, state, dispatch);\n\n  // if we are redrawing after expensive config change, need to force coupling nodes to the front!\n  // TODO: better would be to use a different top-level group...\n  group.selectAll(\".coupling\").raise();\n\n  // zooming - see https://observablehq.com/@d3/zoomable-map-tiles?collection=@d3/d3-zoom\n  const zoomed = () => {\n    group.attr(\"transform\", d3.event.transform);\n  };\n\n  svg.call(\n    d3\n      .zoom()\n      .extent([\n        [0, 0],\n        [w, h],\n      ])\n      .scaleExtent([0.5, 16])\n      .on(\"zoom\", zoomed)\n  );\n};\n\nfunction drawTimescale(d3TimescaleContainer, timescaleData, state, dispatch) {\n  const { config } = state;\n  const {\n    dateRange: { earliest, latest },\n    layout: { timescaleHeight },\n  } = config;\n\n  const margin = { left: 5, right: 5, bottom: 20, top: 10 };\n  const height = timescaleHeight - (margin.bottom + margin.top);\n\n  if (!d3TimescaleContainer.current) {\n    console.warn(\"in drawTimescale but d3TimescaleContainer not yet current\");\n    return;\n  }\n  const vizEl = d3TimescaleContainer.current;\n  const width = vizEl.clientWidth;\n  const svg = d3\n    .select(vizEl)\n    .attr(\"viewBox\", [0, 0, width, height])\n    .style(\"height\", `${height}px`);\n\n  const valueFn = (d) => d.commits; // abstracted so we can pick a differnt one\n\n  // we might simplify these, from an overly generic example\n  const area = (x, y) =>\n    d3\n      .area()\n      // .defined(d => !isNaN(valueFn(d)))\n      .x((d) => x(d.day))\n      .y0(y(0))\n      .y1((d) => {\n        // console.log(\"y of\", d, valueFn(d), y(valueFn(d)));\n        return y(valueFn(d));\n      });\n\n  const yMax = d3.max(timescaleData, valueFn);\n\n  const xScale = d3\n    .scaleUtc()\n    .domain(d3.extent(timescaleData, (d) => d.day))\n    .range([margin.left, width - margin.right, width]);\n  const yScale = d3\n    .scaleLinear()\n    .domain([0, yMax])\n    .range([height - margin.bottom, margin.top]);\n\n  const xAxis = (g, x, h) =>\n    g.attr(\"transform\", `translate(0,${h - margin.bottom})`).call(\n      d3\n        .axisBottom(x)\n        .ticks(width / 80)\n        .tickSizeOuter(0)\n    );\n\n  const brush = d3\n    .brushX()\n    .extent([\n      [margin.left, 0.5],\n      [width - margin.right, height - margin.bottom + 0.5],\n    ])\n    // .on(\"brush\", () => {\n    //   console.log(\"brush ignored\");\n    // })\n    .on(\"end\", () => {\n      if (d3.event.selection) {\n        const [startDate, endDate] = d3.event.selection\n          .map((x) => xScale.invert(x))\n          .map(dateToUnix);\n        if (startDate !== earliest || endDate !== latest) {\n          dispatch({ type: \"setDateRange\", payload: [startDate, endDate] });\n        }\n      }\n    });\n\n  const selection = [xScale(unixToDate(earliest)), xScale(unixToDate(latest))];\n\n  // update or draw x axis - using join as an experiment so we don't keep appending new axes on redraw\n  svg\n    .selectAll(\"g.x-axis\")\n    .data([null])\n    .join((enter) =>\n      enter.append(\"g\").classed(\"x-axis\", true).call(xAxis, xScale, height)\n    );\n\n  svg\n    .selectAll(\"path.graph\")\n    .data([timescaleData])\n    .join((enter) => enter.append(\"path\").classed(\"graph\", true))\n    .attr(\"fill\", \"steelblue\")\n    .attr(\"d\", area(xScale, yScale));\n\n  svg\n    .selectAll(\"g.brush\")\n    .data([null])\n    .join((enter) => enter.append(\"g\").classed(\"brush\", true).call(brush))\n    .call(brush.move, selection);\n}\n\n// see https://stackoverflow.com/questions/53446020/how-to-compare-oldvalues-and-newvalues-on-react-hooks-useeffect\nfunction usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n\nconst updateBodyTheme = (newTheme) => {\n  document.body.className = newTheme;\n};\n\nconst Viz = (props) => {\n  const d3Container = useRef(null);\n  const d3TimescaleContainer = useRef(null);\n  const { dataRef, state, dispatch } = props;\n\n  const prevState = usePrevious(state);\n\n  useEffect(() => {\n    const {\n      metadata: { timescaleData },\n      metadata,\n      files,\n    } = dataRef.current;\n    const { config, expensiveConfig, couplingConfig } = state;\n    if (\n      prevState === undefined ||\n      !_.isEqual(prevState.expensiveConfig, expensiveConfig)\n    ) {\n      console.log(\"expensive config change - rebuild all\");\n      draw(d3Container, files, metadata, state, dispatch);\n      drawTimescale(d3TimescaleContainer, timescaleData, state, dispatch);\n      updateBodyTheme(state.config.colours.currentTheme);\n    } else {\n      if (!_.isEqual(prevState.config, config)) {\n        console.log(\"cheap config change - just redraw\");\n        update(d3Container, files, metadata, state);\n        if (\n          prevState.config.colours.currentTheme !==\n          state.config.colours.currentTheme\n        ) {\n          updateBodyTheme(state.config.colours.currentTheme);\n        }\n      }\n      if (!_.isEqual(prevState.couplingConfig, couplingConfig)) {\n        console.log(\"coupling change\");\n        updateCoupling(d3Container, files, metadata, state, dispatch);\n      }\n    }\n  }, [dataRef, state, dispatch, prevState]);\n\n  return (\n    <aside className=\"Viz\">\n      <svg className=\"chart\" ref={d3Container}>\n        <defs>\n          {/* arrowhead marker definition */}\n          <marker\n            id=\"arrow\"\n            viewBox=\"0 0 4 4\"\n            refX=\"2\"\n            refY=\"2\"\n            markerWidth=\"5\"\n            markerHeight=\"5\"\n            markerUnits=\"strokeWidth\"\n            xoverflow=\"visible\"\n            orient=\"auto-start-reverse\"\n          >\n            <path d=\"M0,0L4,2L0,4z\" fill=\"#ff6300\" />\n          </marker>\n        </defs>\n        <g className=\"topGroup\" />\n      </svg>\n      <svg className=\"timescale\" ref={d3TimescaleContainer} />\n    </aside>\n  );\n};\nViz.propTypes = defaultPropTypes;\nexport default Viz;\n","import _ from \"lodash\";\nimport moment from \"moment\";\nimport VisualizationData from \"./visualizationData\";\n\nfunction initialiseGlobalState(initialDataRef) {\n  const {\n    metadata: {\n      stats: { maxDepth, earliestCommit, latestCommit, coupling },\n    },\n  } = initialDataRef.current;\n\n  const twoYearsAgo = moment.unix(latestCommit).subtract(2, \"year\").unix();\n\n  const earliest = twoYearsAgo < earliestCommit ? earliestCommit : twoYearsAgo;\n  const couplingAvailable = coupling !== undefined;\n\n  const defaults = {\n    config: {\n      visualization: \"language\",\n      subVis: undefined,\n      layout: {\n        timescaleHeight: 130, // including margins\n      },\n      loc: {\n        bad: 1000,\n        good: 0,\n        ugly: 10000,\n        precision: 0, // number of float digits to show\n      },\n      indentation: {\n        // replace indentation when we've refactored everything\n        sum: {\n          bad: 10000,\n          good: 0,\n          ugly: 100000,\n          precision: 0,\n        },\n        p99: {\n          bad: 30,\n          good: 0,\n          ugly: 80,\n          precision: 0,\n        },\n        stddev: {\n          bad: 10,\n          good: 3,\n          ugly: 20,\n          precision: 2,\n        },\n      },\n      age: {\n        bad: 365,\n        good: 0,\n        ugly: 365 * 4,\n        maxAge: 365 * 2,\n        precision: 0,\n      },\n      creation: {\n        // these are not needed - using selection!\n        low: 0,\n        high: Math.floor((latestCommit - earliestCommit) / (24 * 60 * 60)),\n        precision: 0,\n      },\n      churn: {\n        lines: {\n          bad: 10,\n          good: 0,\n          ugly: 100,\n          precision: 2,\n        },\n        days: {\n          bad: 0.1,\n          good: 0,\n          ugly: 0.5,\n          precision: 4,\n        },\n        commits: {\n          bad: 0.1,\n          good: 0,\n          ugly: 1,\n          precision: 4,\n        },\n      },\n      numberOfChangers: {\n        // more of a colour thing than a scale really\n        noChangersColour: \"cyan\",\n        oneChangerColour: \"brown\",\n        fewChangersMinColour: \"green\",\n        fewChangersMaxColour: \"blue\",\n        fewChangersMin: 2,\n        fewChangersMax: 8, // this is a candidate to configure!\n        manyChangersColour: \"yellow\",\n        manyChangersMax: 30, // starting to feel like a crowd\n        precision: 0,\n        topChangersCount: 5, // show this many changers in NodeInspector\n      },\n      colours: {\n        currentTheme: \"dark\", // also sets css on the body!\n        dark: {\n          defaultStroke: \"#111111\",\n          selectedStroke: \"#fffa00\",\n          couplingStroke: \"#ff6300\", // need to change the arrow colour as well if you change this!\n          goodColour: \"blue\",\n          badColour: \"red\",\n          uglyColour: \"yellow\",\n          earlyColour: \"blue\",\n          lateColour: \"green\",\n          neutralColour: \"#808080\",\n          nonexistentColour: \"#111111\",\n          circlePackBackground: \"#111111\",\n        },\n        light: {\n          defaultStroke: \"#f7f7f7\",\n          selectedStroke: \"#fffa00\",\n          couplingStroke: \"#ff6300\", // need to change the arrow colour as well if you change this!\n          goodColour: \"blue\",\n          badColour: \"red\",\n          uglyColour: \"yellow\",\n          earlyColour: \"blue\",\n          lateColour: \"green\",\n          neutralColour: \"#808080\",\n          nonexistentColour: \"#f7f7f7\",\n          circlePackBackground: \"#f7f7f7\",\n        },\n      },\n      dateRange: {\n        earliest,\n        latest: latestCommit,\n      },\n      selectedNode: null,\n    },\n    couplingConfig: {\n      couplingAvailable,\n      shown: false,\n      minDays: 10,\n      minRatio: 0.9,\n      // maxCommonRoots - -1 means show all coupling\n      // 0 means only show files who have no roots in common - so /foo/baz.txt and /bar/baz.js\n      // 1 means only show files who have 0 or 1 roots in common - so /foo/bar/baz and /foo/fi/fum can match\n      maxCommonRoots: -1,\n      dateRange: {\n        // TODO: use buckets instead!\n        earliest,\n        latest: latestCommit,\n      },\n    },\n    expensiveConfig: {\n      depth: maxDepth,\n    },\n  };\n  return defaults;\n}\n\nfunction themedColours(config) {\n  return config.colours[config.colours.currentTheme];\n}\n\nfunction globalDispatchReducer(state, action) {\n  const { expensiveConfig, couplingConfig, config } = state;\n  switch (action.type) {\n    case \"setVisualization\": {\n      const visualization = action.payload;\n      const visData = VisualizationData[visualization];\n      if (visData.subVis) {\n        const subVis = visData.defaultChild;\n        return {\n          ...state,\n          config: {\n            ...config,\n            visualization,\n            subVis,\n          },\n        };\n      }\n      return { ...state, config: { ...config, visualization } };\n    }\n    case \"setSubVisualization\":\n      return { ...state, config: { ...config, subVis: action.payload } };\n    case \"setDepth\":\n      return {\n        ...state,\n        expensiveConfig: { ...expensiveConfig, depth: action.payload },\n      };\n    case \"setShowCoupling\": {\n      return {\n        ...state,\n        couplingConfig: { ...couplingConfig, shown: action.payload },\n      };\n    }\n    case \"setMinCouplingRatio\": {\n      return {\n        ...state,\n        couplingConfig: { ...couplingConfig, minRatio: action.payload },\n      };\n    }\n    case \"setCouplingMinDays\": {\n      return {\n        ...state,\n        couplingConfig: { ...couplingConfig, minDays: action.payload },\n      };\n    }\n    case \"setCouplingMaxCommonRoots\": {\n      return {\n        ...state,\n        couplingConfig: { ...couplingConfig, maxCommonRoots: action.payload },\n      };\n    }\n    case \"selectNode\":\n      return {\n        ...state,\n        config: { ...config, selectedNode: action.payload },\n      };\n\n    case \"setDateRange\": {\n      console.log(\"Setting dates\", action.payload);\n      const [early, late] = action.payload;\n      const result = _.cloneDeep(state);\n      result.config.dateRange.earliest = early;\n      result.config.dateRange.latest = late;\n      result.couplingConfig.dateRange.earliest = early;\n      result.couplingConfig.dateRange.latest = late;\n      return result;\n    }\n\n    case \"setTheme\": {\n      const result = _.cloneDeep(state);\n      result.config.colours.currentTheme = action.payload;\n      return result;\n    }\n\n    default:\n      throw new Error(`Invalid dispatch type ${action.type}`);\n  }\n}\n\nexport { themedColours, initialiseGlobalState, globalDispatchReducer };\n","/* eslint-disable react/forbid-prop-types */\nimport React, { useReducer } from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"./App.css\";\nimport Controller from \"./Controller\";\nimport Inspector from \"./Inspector\";\nimport Viz from \"./Viz\";\nimport { globalDispatchReducer, initialiseGlobalState } from \"./State\";\n\nconst App = (props) => {\n  // eslint-disable-next-line react/prop-types\n  const { dataRef } = props;\n\n  const [vizState, dispatch] = useReducer(\n    globalDispatchReducer,\n    dataRef,\n    initialiseGlobalState\n  );\n\n  return (\n    <div className=\"App\">\n      <header className=\"App-header\">\n        <h1>Polyglot Code Explorer (beta)</h1>\n      </header>\n      <Viz dataRef={dataRef} state={vizState} dispatch={dispatch} />\n      <Controller dataRef={dataRef} state={vizState} dispatch={dispatch} />\n      <Inspector dataRef={dataRef} state={vizState} dispatch={dispatch} />\n    </div>\n  );\n};\n\nApp.propTypes = {\n  dataRef: PropTypes.shape({ current: PropTypes.any }).isRequired,\n};\n\nexport default App;\n","/* eslint-disable no-param-reassign */\nimport _ from \"lodash\";\nimport * as d3 from \"d3\";\nimport moment from \"moment\";\nimport { nodeGitData, nodeLinesOfCode, nodeLocData } from \"./nodeData\";\n\nfunction addLanguagesFromNode(counts, node) {\n  const loc = nodeLocData(node);\n  if (loc) {\n    const { language, code } = loc;\n    if (!counts[language]) {\n      counts[language] = { count: 0, loc: 0 };\n    }\n    counts[language].count += 1;\n    counts[language].loc += code;\n  }\n  if (node.children !== undefined) {\n    for (const child of node.children) {\n      addLanguagesFromNode(counts, child);\n    }\n  }\n}\n\n/* eslint-enable no-param-reassign */\nexport function countLanguagesIn(data) {\n  const counts = {};\n  addLanguagesFromNode(counts, data);\n  const countsPairs = [...Object.keys(counts)].map((k) => [k, counts[k]]);\n  const sortedMap = [...countsPairs].sort(\n    ([l1, k1], [l2, k2]) => k2.loc - k1.loc\n  );\n  const colours = d3.schemeTableau10;\n  const otherColour = \"#303030\";\n  const languageMap = {};\n  const languageKey = [];\n  sortedMap.forEach(([key, val], index) => {\n    const colour = index < colours.length ? colours[index] : otherColour;\n    languageMap[key] = { ...val, colour };\n    if (index < colours.length) {\n      languageKey.push({ ...val, language: key, colour });\n    }\n  });\n  return { languageKey, languageMap, otherColour };\n}\n\nfunction gatherNodeStats(node, statsSoFar, depth) {\n  let stats = _.cloneDeep(statsSoFar);\n  if (stats.maxDepth < depth) {\n    stats.maxDepth = depth;\n  }\n  const loc = nodeLinesOfCode(node);\n  if (loc && loc > stats.maxLoc) {\n    stats.maxLoc = loc;\n  }\n  const gitData = nodeGitData(node);\n  if (gitData && gitData.details && gitData.details.length > 0) {\n    const days = gitData.details.map((d) => d.commit_day);\n    if (gitData.lastUpdate) {\n      days.push(gitData.lastUpdate);\n    }\n    if (gitData.creationDate) {\n      days.push(gitData.creationDate);\n    }\n    days.sort();\n    const earliest = days[0];\n    const latest = days[days.length - 1];\n    if (stats.earliestCommit === undefined || earliest < stats.earliestCommit) {\n      stats.earliestCommit = earliest;\n    }\n    if (stats.latestCommit === undefined || latest > stats.latestCommit) {\n      stats.latestCommit = latest;\n    }\n  }\n  if (node.children !== undefined) {\n    stats = node.children.reduce((memo, child) => {\n      return gatherNodeStats(child, memo, depth + 1);\n    }, stats);\n  }\n  return stats;\n}\n\nexport function gatherGlobalStats(data) {\n  const statsSoFar = {\n    earliestCommit: undefined,\n    latestCommit: undefined,\n    maxDepth: 0,\n    maxLoc: 0,\n    churn: {\n      maxLines: 0,\n      maxCommits: 0,\n      maxDays: 0,\n    },\n  };\n  return gatherNodeStats(data, statsSoFar, 0);\n}\n\n// yes, I'm modifying a parameter, it's hard to avoid in JavaScript with big data structures\n// timeUnit is 'week' or similar, passed to https://momentjs.com/docs/#/manipulating/start-of/\nfunction addTimescaleData(timescaleData, node, timeUnit) {\n  const gitData = nodeGitData(node);\n  if (gitData && gitData.details && gitData.details.length > 0) {\n    gitData.details.forEach((data) => {\n      const startDate = moment.unix(data.commit_day).startOf(timeUnit).unix();\n      let dateData = timescaleData.get(startDate);\n      if (!dateData)\n        dateData = {\n          files: 0,\n          commits: 0,\n          lines_added: 0,\n          lines_deleted: 0,\n        };\n      dateData.files += 1;\n      dateData.commits += data.commits;\n      dateData.lines_added += data.lines_added;\n      dateData.lines_deleted += data.lines_deleted;\n      timescaleData.set(startDate, dateData);\n    });\n  }\n  if (node.children !== undefined) {\n    node.children.forEach((child) => {\n      addTimescaleData(timescaleData, child, timeUnit);\n    });\n  }\n}\n\nexport function gatherTimescaleData(data, timeUnit) {\n  const timescaleData = new Map();\n  addTimescaleData(timescaleData, data, timeUnit);\n  // convert to a simple sorted array, as that's all we need really\n  return [...timescaleData]\n    .map(([day, dayData]) => {\n      // convert to Javascript dates as d3 likes them - sigh.  I could do this on display?\n      return { day: moment.unix(day).toDate(), ...dayData };\n    })\n    .sort((a, b) => a.day - b.day);\n}\n\n// yes, I'm modifying a parameter, it's hard to avoid in JavaScript with big data structures\nfunction addNodesByPath(nodesByPath, node) {\n  // eslint-disable-next-line no-param-reassign\n  nodesByPath[node.path] = node;\n  if (node.children !== undefined) {\n    node.children.forEach((child) => {\n      addNodesByPath(nodesByPath, child);\n    });\n  }\n}\n\nexport function gatherNodesByPath(data) {\n  const nodesByPath = {};\n  addNodesByPath(nodesByPath, data);\n  return nodesByPath;\n}\n","import React, { useState, useEffect, useRef } from \"react\";\nimport App from \"./App\";\nimport {\n  countLanguagesIn,\n  gatherTimescaleData,\n  gatherGlobalStats,\n  gatherNodesByPath,\n} from \"./preprocess\";\n\nconst useFetch = (url) => {\n  const [data, setData] = useState(null);\n\n  useEffect(() => {\n    async function fetchData() {\n      const response = await fetch(url);\n      const json = await response.json();\n      console.log(\"postprocessing languages\");\n      const languages = countLanguagesIn(json);\n      console.log(\"postprocessing global stats\");\n      const stats = gatherGlobalStats(json);\n      console.log(\"building node index\");\n      const nodesByPath = gatherNodesByPath(json);\n      console.log(\"building date scale data\");\n      const timescaleData = gatherTimescaleData(json, \"week\");\n      console.log(\"postprocessing complete\");\n      const { users } = json.data.git_meta;\n      if (json.data.coupling_meta) {\n        stats.coupling = {\n          bucketCount: json.data.coupling_meta.bucket_count,\n          bucketSize: json.data.coupling_meta.bucket_size,\n          firstBucketStart: json.data.coupling_meta.first_bucket_start,\n        };\n      }\n      const metadata = {\n        languages,\n        stats,\n        users,\n        nodesByPath,\n        timescaleData,\n      };\n      setData({ files: json, metadata });\n    }\n    fetchData();\n  }, [url]);\n\n  return data;\n};\n\nconst Loader = () => {\n  const dataFile = process.env.REACT_APP_EXPLORER_DATA || \"default\";\n  const url = `${process.env.PUBLIC_URL}/data/${dataFile}.json`;\n\n  const dataRef = useRef(null);\n\n  const data = useFetch(url);\n  dataRef.current = data;\n\n  return data == null ? <div>Loading...</div> : <App dataRef={dataRef} />;\n};\n\nexport default Loader;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./css/normalize.css\";\nimport \"./css/custom.css\";\nimport Loader from \"./Loader\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(<Loader />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"pathlist\":\"PathInspector_pathlist__3wx_X\"};"],"sourceRoot":""}